{% extends "base.html" %}
{% block content %}
<h1 style="text-align:center; font-size:32px; font-weight:900; margin-bottom:30px; color:#7c5cff;">
  Cart
</h1>

<div style="display:flex; justify-content:center; margin-left: 150px; margin-right: -750px; padding:40px 20px;">
  <div style="width:100%; max-width:1000px;">

    {% if not rest %}
      <div class="card subtle" style="text-align:center;">
        <div class="card-title">Empty</div>
        <p class="muted">Add items from a restaurant menu.</p>
        <a class="btn primary" href="{{ url_for('public_restaurants') }}">Browse Restaurants</a>
      </div>
    {% else %}
      <div class="card glow">
        <div class="card-title">Restaurant: {{ rest.name }}</div>

        <!-- Cart items -->
        <form method="post" action="{{ url_for('public_cart_update') }}">
          <div class="table">
            <div class="tr head">
              <div>Item</div>
              <div>Price</div>
              <div>Qty</div>
              <div>Line</div>
            </div>
            {% for mi, qty, line_total in lines %}
            <div class="tr">
              <div>{{ mi.name }}</div>
              <div>PKR {{ money_str(mi.price) }}</div>
              <div><input name="qty_{{ mi.menu_id }}" type="number" min="0" value="{{ qty }}"></div>
              <div>PKR {{ money_str(line_total) }}</div>
            </div>
            {% endfor %}
          </div>
          <div class="row" style="justify-content:space-between; margin-top:10px">
            <div class="pill ghost">Total: <b>PKR {{ money_str(total) }}</b></div>
            <button class="btn" type="submit">Update Cart</button>
          </div>
        </form>

        <div class="divider"></div>

        <!-- Guest checkout form -->
        <form class="form" method="post" action="{{ url_for('public_checkout') }}">
          <label>
            Full Name
            <input name="customer_name" placeholder="e.g. Ali Khan" required>
          </label>
          <label>
            Phone Number
            <input name="customer_phone" placeholder="03xx-xxxxxxx" required>
          </label>
          <label>
            Address
            <textarea name="customer_address" placeholder="House #, Street, City" required></textarea>
          </label>

          <div class="row">
            <label>
              Payment
              <select name="payment_method" required>
                <option value="COD">Cash on Delivery</option>
                <option value="Online">Online</option>
              </select>
            </label>
            <label>
              Instructions
              <input name="delivery_instructions" placeholder="e.g. Gate 2">
            </label>
          </div>

          <div class="row" style="margin-top:10px; justify-content:flex-end; gap:10px;">
            <button class="btn primary" type="submit">Place Order</button>
            <button class="btn warn" type="submit" formaction="{{ url_for('public_cart_clear') }}"
              onclick="return confirm('Clear cart?');">Clear</button>
          </div>
        </form>
      </div>
    {% endif %}

  </div>
</div>
{% endblock %}
